/**
 * @license
 * pixi-multistyle-text - v0.2.2
 * Copyright (c) 2014, Tommy Leunen <tommy.leunen@gmail.com> (http://tommyleunen.com/)
 * Released under the MIT license
 * See https://github.com/tleunen/pixi-multistyle-text for more details
 * Fix and add custom lineHeight by MichaÃ«l Chartrand
 */
(function(){function t(t){t=t||{},t.font=t.font||"bold 20pt Arial",t.fill=t.fill||"black",t.stroke=t.stroke||"black",t.strokeThickness=t.strokeThickness||0,t.dropShadow=t.dropShadow||!1,t.dropShadowAngle=t.dropShadowAngle||Math.PI/6,t.dropShadowDistance=t.dropShadowDistance||4,t.dropShadowColor=t.dropShadowColor||"black"}function e(t,e){return{text:t,style:e,width:0,height:0,fontProperties:null}}var i=this,s=i.PIXI;if(s){var o=function(t,e,i){s.Text.call(this,t,i),this.setTextStyles(e)};o.prototype=Object.create(s.Text.prototype),o.prototype.constructor=o,o.prototype.setAlignmentStyle=o.prototype.setStyle=function(t){t=t||{},t.align=t.align||"left",t.wordWrap=t.wordWrap||!1,t.wordWrapWidth=t.wordWrapWidth||100,this.style=t,this.dirty=!0},o.prototype.setTextStyles=function(e){for(var i in e)e.hasOwnProperty(i)&&t(e[i]);e.def||(e.def={},t(e.def)),this.textStyles=e,this.dirty=!0},o.prototype._getTextDataPerLine=function(t){for(var i=[],s=Object.keys(this.textStyles).join("|"),o=new RegExp("</?("+s+")>","g"),h=this.textStyles.def,n=0;n<t.length;n++){for(var r,l=[],a=[];null!==(r=o.exec(t[n]))&&a.push(r););if(a.length){for(var d=0,c=0;c<a.length;c++)a[c].index>d&&l.push(e(t[n].substring(d,a[c].index),h)),h="/"==a[c][0][1]?this.textStyles.def:this.textStyles[a[c][1]]||this.textStyles.def,d=a[c].index+a[c][0].length;d<t[n].length&&l.push({text:t[n].substring(d),style:h})}else l.push(e(t[n],h));i.push(l)}return i},o.prototype.updateText=function(){this.texture.baseTexture.resolution=this.resolution;var t,e,i=this.text,s=this.textStyles;this.style.wordWrap&&(i=this.wordWrap(this.text));var o=i.split(/(?:\r\n|\r|\n)/),h=this._getTextDataPerLine(o),n=[],r=[],l=0;for(t=0;t<o.length;t++){var a=0,d=0;for(e=0;e<h[t].length;e++)this.context.font=h[t][e].style.font,h[t][e].width=this.context.measureText(h[t][e].text).width,a+=h[t][e].width,h[t][e].fontProperties=this.determineFontProperties(h[t][e].style.font),h[t][e].height=h[t][e].fontProperties.fontSize+h[t][e].style.strokeThickness,d=Math.max(d,h[t][e].height);n[t]=a,r[t]=d,l=Math.max(l,a)}var c=Object.keys(s).map(function(t){return s[t]}),p=c.reduce(function(t,e){return Math.max(t,e.strokeThickness)},0),x=c.reduce(function(t,e){var i=e.dropShadow?e.dropShadowDistance:0;return Math.max(t,i)},0),f=l+p+x,y=Math.max.apply(null,r)*o.length+x;this.style.lineHeight&&(y=this.style.lineHeight+h.length*this.style.lineHeight),this.canvas.width=(f+this.context.lineWidth)*this.resolution,this.canvas.height=y*this.resolution,this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.textBaseline="alphabetic",this.context.lineJoin="round";var g,u;for(t=0;t<h.length;t++){var S=h[t];for(g=0,e=0;e<S.length;e++){var w=S[e].style,k=S[e].text,v=S[e].fontProperties;if(this.context.font=w.font,this.context.strokeStyle=w.stroke,this.context.lineWidth=w.strokeThickness,g+=p/2,u=p/2+t*r[t]+v.ascent,this.style.lineHeight&&(u=this.style.lineHeight+t*this.style.lineHeight),"right"===this.style.align?g+=l-n[t]:"center"===this.style.align&&0===g&&(g+=(l-n[t])/2),"bottom"===w.valign?u+=r[t]-S[e].height-(p-w.strokeThickness)/2:"middle"===w.valign&&(u+=(r[t]-S[e].height)/2-(p-w.strokeThickness)/2),w.dropShadow){this.context.fillStyle=w.dropShadowColor;var T=Math.sin(w.dropShadowAngle)*w.dropShadowDistance,b=Math.cos(w.dropShadowAngle)*w.dropShadowDistance;w.fill&&this.context.fillText(k,g+T,u+b)}this.context.fillStyle=w.fill,w.stroke&&w.strokeThickness&&this.context.strokeText(k,g,u),w.fill&&this.context.fillText(k,g,u),g+=S[e].width,g-=p/2}}this.updateTexture()},s.MultiStyleText=o}}).call(this);
